generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

<<<<<<< HEAD
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)
=======
// Enums for PostgreSQL
enum Role {
  USER
  MODERATOR
  ADMIN
  OWNER
}

enum ChannelType {
  PUBLIC
  PRIVATE
  ANNOUNCEMENT
}

enum ReportStatus {
  PENDING
  REVIEWED
  RESOLVED
  DISMISSED
}

enum SubscriptionStatus {
  PENDING
  ACTIVE
  CANCELED
  EXPIRED
  PAST_DUE
}

model Account {
  id                 String   @id @default(cuid())
  userId             String
  type               String
  provider           String
  providerAccountId  String
  refresh_token      String?  @db.Text
  access_token       String?  @db.Text
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String?  @db.Text
  session_state      String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
>>>>>>> 95514d72df2b70d50a6dc5e0eeef5d759b59b2c6

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model User {
<<<<<<< HEAD
  id                String         @id @default(cuid())
  email             String         @unique
  username          String         @unique
  hashedPassword    String?
  image             String?
  bio               String?
  role              Role           @default(USER)
  gradeId           String?
  emailVerified     DateTime?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  displayName       String?
  usernameChangedAt DateTime?
  accounts          Account[]
  bookmarks         Bookmark[]
  following         Follow[]       @relation("Followers")
  followers         Follow[]       @relation("Following")
  receivedMessages  Message[]      @relation("ReceivedMessages")
  sentMessages      Message[]      @relation("SentMessages")
  notifications     Notification[]
  posts             Post[]
  reactions         Reaction[]
  reports           Report[]
  sessions          Session[]
  subscriptions     Subscription[]
  threads           Thread[]
  grade             Grade?         @relation(fields: [gradeId], references: [id])
  badges            UserBadge[]
=======
  id                 String   @id @default(cuid())
  email              String   @unique
  username           String   @unique
  displayName        String?
  usernameChangedAt  DateTime?
  hashedPassword     String?
  image              String? 
  bio                String?  @db.Text
  role               Role     @default(USER)
  gradeId            String?
  isBanned           Boolean  @default(false)
  banReason          String?  @db.Text
  emailVerified      DateTime?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  grade            Grade?         @relation(fields: [gradeId], references: [id])
  threads          Thread[]
  posts            Post[]
  reactions        Reaction[]
  reports          Report[]
  subscriptions    Subscription[]
  accounts         Account[]
  sessions         Session[]
  bookmarks        Bookmark[]
  notifications    Notification[]
  followers        Follow[]       @relation("Following")
  following        Follow[]       @relation("Followers")
  sentMessages     Message[]      @relation("SentMessages")
  receivedMessages Message[]      @relation("ReceivedMessages")
  badges           UserBadge[]
>>>>>>> 95514d72df2b70d50a6dc5e0eeef5d759b59b2c6

  @@index([username])
  @@index([gradeId])
  @@index([email])
  @@index([createdAt])
}

model Grade {
<<<<<<< HEAD
  id            String         @id @default(cuid())
  name          String         @unique
  slug          String         @unique
  color         String
  icon          String?
  priceMonthly  Int            @default(0)
  position      Int            @default(0)
  permissions   Json           @default("{}")
=======
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique
  color       String
  icon        String?
  priceMonthly Int     @default(0)
  position    Int      @default(0)
  permissions String   @default("{}") @db.Text

  users       User[]
>>>>>>> 95514d72df2b70d50a6dc5e0eeef5d759b59b2c6
  subscriptions Subscription[]
  users         User[]

  @@index([position])
  @@index([slug])
  @@index([priceMonthly])
}

model ForumCategory {
  id        String   @id @default(cuid())
  name      String   @unique
  slug      String   @unique
  position  Int      @default(0)
  createdAt DateTime @default(now())
  topics    Topic[]

  @@index([slug])
  @@index([position])
}

model Topic {
  id          String         @id @default(cuid())
  name        String         @unique
  slug        String         @unique
  icon        String?
  color       String?
  position    Int            @default(0)
  createdAt   DateTime       @default(now())
  categoryId  String?
  description String?
  threads     Thread[]
  category    ForumCategory? @relation(fields: [categoryId], references: [id])

  @@index([slug])
  @@index([position])
  @@index([categoryId])
}

model Thread {
<<<<<<< HEAD
  id        String     @id @default(cuid())
  authorId  String
  title     String
  content   String
  pinned    Boolean    @default(false)
  locked    Boolean    @default(false)
  viewCount Int        @default(0)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  imageUrl  String?
  topicId   String?
  bookmarks Bookmark[]
  posts     Post[]
  reactions Reaction[]
  reports   Report[]
  author    User       @relation(fields: [authorId], references: [id], onDelete: Cascade)
  topic     Topic?     @relation(fields: [topicId], references: [id])
=======
  id         String   @id @default(cuid())
  topicId    String?
  authorId   String
  title      String
  content    String   @db.Text
  imageUrl   String? 
  locked     Boolean  @default(false)
  pinned     Boolean  @default(false)
  viewCount  Int      @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  topic      Topic?    @relation(fields: [topicId], references: [id], onDelete: SetNull)
  author     User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  posts      Post[]
  reactions  Reaction[]
  reports    Report[]
  bookmarks  Bookmark[]
>>>>>>> 95514d72df2b70d50a6dc5e0eeef5d759b59b2c6

  @@index([topicId])
  @@index([authorId])
  @@index([createdAt])
  @@index([pinned])
}

model Post {
<<<<<<< HEAD
  id        String     @id @default(cuid())
  threadId  String
  authorId  String
  content   String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  author    User       @relation(fields: [authorId], references: [id], onDelete: Cascade)
  thread    Thread     @relation(fields: [threadId], references: [id], onDelete: Cascade)
  reactions Reaction[]
  reports   Report[]
=======
  id         String   @id @default(cuid())
  threadId   String
  authorId   String
  parentId   String?
  content    String   @db.Text
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  thread     Thread   @relation(fields: [threadId], references: [id], onDelete: Cascade)
  author     User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  parent     Post?    @relation("PostReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies    Post[]   @relation("PostReplies")
  reactions  Reaction[]
  reports    Report[]
>>>>>>> 95514d72df2b70d50a6dc5e0eeef5d759b59b2c6

  @@index([threadId])
  @@index([authorId])
  @@index([parentId])
  @@index([createdAt])
}

model Reaction {
  id        String   @id @default(cuid())
  userId    String
  threadId  String?
  postId    String?
  type      String   @default("like")
  createdAt DateTime @default(now())
  post      Post?    @relation(fields: [postId], references: [id], onDelete: Cascade)
  thread    Thread?  @relation(fields: [threadId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, threadId, postId, type])
  @@index([userId])
  @@index([threadId])
  @@index([postId])
}

model Report {
  id        String       @id @default(cuid())
  postId    String?
  reason    String
  status    ReportStatus @default(PENDING)
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  threadId  String?
  userId    String
  post      Post?        @relation(fields: [postId], references: [id], onDelete: Cascade)
  thread    Thread?      @relation(fields: [threadId], references: [id], onDelete: Cascade)
  user      User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

model Subscription {
  id        String             @id @default(cuid())
  userId    String
  gradeId   String
  status    SubscriptionStatus @default(PENDING)
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  endDate   DateTime?
  startDate DateTime           @default(now())
  grade     Grade              @relation(fields: [gradeId], references: [id])
  user      User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([gradeId])
  @@index([status])
}

model Bookmark {
  id        String   @id @default(cuid())
  userId    String
  threadId  String
  createdAt DateTime @default(now())
  thread    Thread   @relation(fields: [threadId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, threadId])
  @@index([userId])
  @@index([threadId])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  type      String
  title     String
  message   String
  read      Boolean  @default(false)
  link      String?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([read])
  @@index([createdAt])
}

model Follow {
  id          String   @id @default(cuid())
  followerId  String
  followingId String
  createdAt   DateTime @default(now())
  follower    User     @relation("Followers", fields: [followerId], references: [id], onDelete: Cascade)
  following   User     @relation("Following", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

model Message {
  id         String   @id @default(cuid())
  senderId   String
  receiverId String
  content    String
  read       Boolean  @default(false)
  createdAt  DateTime @default(now())
  receiver   User     @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
  sender     User     @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([receiverId])
  @@index([createdAt])
}

model Badge {
<<<<<<< HEAD
  id          String      @id @default(cuid())
  name        String      @unique
  description String?
  icon        String
  color       String
  condition   String
  createdAt   DateTime    @default(now())
=======
  id          String   @id @default(cuid())
  name        String   @unique
  description String?  @db.Text
  icon        String
  color       String
  condition   String   @db.Text
  createdAt   DateTime @default(now())

>>>>>>> 95514d72df2b70d50a6dc5e0eeef5d759b59b2c6
  users       UserBadge[]
}

model UserBadge {
  id       String   @id @default(cuid())
  userId   String
  badgeId  String
  earnedAt DateTime @default(now())
  badge    Badge    @relation(fields: [badgeId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, badgeId])
  @@index([userId])
  @@index([badgeId])
}

enum Role {
  USER
  MODERATOR
  ADMIN
  OWNER
}

enum ChannelType {
  FORUM
  CHAT
}

enum ReportStatus {
  PENDING
  REVIEWED
  RESOLVED
  DISMISSED
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  PAST_DUE
  PENDING
}
